{
  "version": "1.0",
  "projectName": "adaptive-hints",
  "description": "Adaptive CLI onboarding hints that learn from usage and fade away, plus Axiom telemetry",
  "stories": [
    {
      "id": "story-ml8qhtgc",
      "title": "Usage tracker module — record command runs to ~/.config/skill-cli/usage.json",
      "description": "Create `packages/cli/src/core/usage-tracker.ts` — a module that tracks CLI command usage locally.\n\n**What to build:**\n\n1. `UsageTracker` class with methods:\n   - `record(command: string, opts?: { duration?: number, success?: boolean })` — log a command run\n   - `getUsage()` — return full usage state\n   - `getCommandCount(command: string)` — how many times a command has been run\n   - `hasMilestone(name: string)` — check if a milestone is achieved\n   - `setMilestone(name: string)` — mark a milestone as achieved\n   - `totalRuns()` — total commands ever run\n   - `daysSinceFirstRun()` — how long the user has been using the CLI\n\n2. **Storage:** `~/.config/skill-cli/usage.json` (create dir if needed, use `XDG_CONFIG_HOME` if set)\n\n3. **Schema:**\n```typescript\ninterface UsageState {\n  firstRun: string  // ISO timestamp\n  totalRuns: number\n  commands: Record<string, { count: number, lastRun: string, firstRun: string }>\n  milestones: Record<string, { achieved: boolean, achievedAt?: string }>\n}\n```\n\n4. **Error handling:** If file is corrupt/unreadable, reset to defaults silently. Never crash the CLI because of usage tracking.\n\n5. **Singleton:** Export `getUsageTracker()` that returns a cached instance.\n\n**Tests:** `packages/cli/tests/unit/core/usage-tracker.test.ts`\n- Test record increments count\n- Test milestone set/get\n- Test totalRuns calculation\n- Test daysSinceFirstRun\n- Test corrupt file recovery\n- Test XDG_CONFIG_HOME override\n\n**Files:** `packages/cli/src/core/usage-tracker.ts`, `packages/cli/tests/unit/core/usage-tracker.test.ts`\n\n**Validation:** (cd packages/cli && bun run test)\n\n**Progress Notification:** Update `progress.txt` with files created/modified, test counts before/after, and any issues encountered.",
      "priority": 1,
      "passes": true,
      "validationCommand": "(cd packages/cli && bun run test)",
      "acceptanceCriteria": [
        "UsageTracker class with record/getUsage/milestone methods",
        "Persists to ~/.config/skill-cli/usage.json",
        "Handles corrupt files gracefully",
        "Singleton via getUsageTracker()",
        "Unit tests cover all methods and edge cases"
      ]
    },
    {
      "id": "story-ml8qi7us",
      "title": "Hint engine — rules for showing and retiring contextual hints",
      "description": "Create `packages/cli/src/core/hint-engine.ts` — a rule-based engine that decides which hints to show based on usage state.\n\n**Files:** `packages/cli/src/core/hint-engine.ts`, `packages/cli/tests/unit/core/hint-engine.test.ts`\n\n**Validation:** (cd packages/cli && bun run test)",
      "priority": 2,
      "passes": true,
      "validationCommand": "(cd packages/cli && bun run test)",
      "acceptanceCriteria": [
        "HintRule type with show/retire conditions",
        "HintEngine with getHints and getPostRunHint",
        "At least 6 onboarding/discovery rules and 3 contextual rules",
        "Max 2 hints per invocation",
        "No hints in --json or --quiet mode",
        "Hints print to stderr",
        "Full test coverage"
      ]
    },
    {
      "id": "story-ml8qijsu",
      "title": "Wire usage tracker + hint engine into CLI command lifecycle",
      "description": "Integrate the usage tracker and hint engine into the CLI's commander lifecycle so hints appear automatically.\n\n**Files:** `packages/cli/src/index.ts` (modify hooks), `packages/cli/tests/integration/commands/hints.test.ts`\n\n**Validation:** (cd packages/cli && bun run test)",
      "priority": 3,
      "passes": false,
      "validationCommand": "(cd packages/cli && bun run test)",
      "acceptanceCriteria": [
        "preAction hook shows onboarding hints to stderr",
        "postAction hook records command usage",
        "Auto-detects and sets milestones",
        "Hints suppressed in --json, --quiet, and piped output",
        "Usage tracking never crashes the CLI",
        "Integration tests for hint display and recording"
      ]
    },
    {
      "id": "story-ml8qixjv",
      "title": "Axiom telemetry — ship anonymized usage events",
      "description": "Add telemetry that ships CLI usage events to Axiom. This is an internal tool on work machines — no anonymization needed, include user identity for per-person analysis.\n\n**Files:** `packages/cli/src/core/telemetry.ts`, `packages/cli/tests/unit/core/telemetry.test.ts`, `packages/cli/src/index.ts` (wire into postAction)\n\n**Validation:** (cd packages/cli && bun run test)",
      "priority": 4,
      "passes": false,
      "validationCommand": "(cd packages/cli && bun run test)",
      "acceptanceCriteria": [
        "TelemetryEvent type with command, duration, success, platform fields",
        "Fire-and-forget sending (never blocks CLI)",
        "SKILL_NO_TELEMETRY=1 opt-out works",
        "Missing AXIOM_TOKEN skips silently",
        "No PII in events",
        "Wired into postAction hook",
        "Unit tests for all conditions"
      ]
    },
    {
      "id": "story-ml8qj99o",
      "title": "Replace static help descriptions with adaptive ones from hint engine",
      "description": "Replace the static help text descriptions in command groups with dynamic versions that adapt based on usage state.\n\n**Files:** `packages/cli/src/core/adaptive-help.ts`, `packages/cli/tests/unit/core/adaptive-help.test.ts`, `packages/cli/src/index.ts`, `packages/cli/src/commands/front/index.ts`, `packages/cli/src/commands/auth/index.ts`\n\n**Validation:** (cd packages/cli && bun run test)",
      "priority": 5,
      "passes": false,
      "validationCommand": "(cd packages/cli && bun run test)",
      "acceptanceCriteria": [
        "getAdaptiveDescription function for each command group",
        "Progressive collapse: full → abbreviated → minimal",
        "Static fallback when usage state unavailable",
        "Root, front, auth, inngest all have adaptive descriptions",
        "Tests for all proficiency levels"
      ]
    },
    {
      "id": "story-ml8qjitq",
      "title": "Changeset + integration test for full adaptive hints flow",
      "description": "Final polish: add changeset, ensure full integration test coverage for the adaptive hints system end-to-end.\n\n**Files:** `.changeset/adaptive-hints.md`, `packages/cli/tests/integration/adaptive-hints.test.ts`, `packages/cli/README.md`\n\n**Validation:** (cd packages/cli && bun run test)",
      "priority": 6,
      "passes": false,
      "validationCommand": "(cd packages/cli && bun run test)",
      "acceptanceCriteria": [
        "Changeset file for minor CLI bump",
        "E2E integration test simulating fresh → proficient user journey",
        "--json and --quiet suppress hints",
        "README documents the feature and opt-out",
        "All tests pass"
      ]
    },
    {
      "id": "story-ml8qpq8a",
      "title": "Auto-update — check npm for new versions and self-update",
      "description": "Add auto-update capability to the CLI. This is an internal tool on work machines — just update, no consent dialogs.\n\n**Files:** `packages/cli/src/core/auto-update.ts`, `packages/cli/tests/unit/core/auto-update.test.ts`, `packages/cli/src/index.ts` (wire into postAction)\n\n**Validation:** (cd packages/cli && bun run test)",
      "priority": 7,
      "passes": false,
      "validationCommand": "(cd packages/cli && bun run test)",
      "acceptanceCriteria": [
        "checkForUpdate() queries npm registry with 1-hour throttle",
        "performUpdate() runs bun/npm global install",
        "Auto-updates after command completion (max once per 24h)",
        "Skips in --json, mcp, and dev modes",
        "SKILL_NO_AUTO_UPDATE=1 opt-out",
        "Graceful failure (never blocks CLI)",
        "Version comparison works for semver",
        "Full test coverage with mocked fetch"
      ]
    }
  ],
  "metadata": {
    "createdAt": "2026-02-04T22:10:00.000Z",
    "totalIterations": 2,
    "lastIteration": "2026-02-05T01:17:36.658Z"
  }
}